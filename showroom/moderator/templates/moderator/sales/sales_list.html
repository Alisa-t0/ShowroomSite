{% extends 'layout_m.html' %}

{% block title %}Список продажів{% endblock %}

{% block content %}
    <h2 style="text-align: center; margin-bottom: 30px;">Список продажів</h2>
    <div class="button-row">
        <form action="{% url 'export_sales' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn export">Експорт даних</button>
        </form>
        </form>
            <form action="{% url 'import_sales' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn import">Імпорт даних</button>
        </form>
    </div>
    <form method="get">
        {% csrf_token %}
        <table>
            <tr>
                <th>
                    <input name="filter_id" type="number">
                    <a href="?sort=id&dir={% if sort_field == 'id' and direction == 'asc' %}desc{% else %}asc{% endif %}">ID</a>
                </th>
                <th>
                    <input name="filter_worker" type="text">
                    <a href="?sort=worker&dir={% if sort_field == 'worker' and direction == 'asc' %}desc{% else %}asc{% endif %}">Робітник</a>
                </th>
                <th>
                    <div class="filter-inline">
                        <input name="filter_car__producer_name" type="text" placeholder="Бренд">
                        <input name="filter_car__model" type="text" placeholder="Модель">
                    </div>
                    <a href="?sort=car&dir={% if sort_field == 'car' and direction == 'asc' %}desc{% else %}asc{% endif %}">Машина</a>
                </th>
                <th>
                    <input name="filter_sale_date" type="date">
                    <a href="?sort=sale_date&dir={% if sort_field == 'sale_date' and direction == 'asc' %}desc{% else %}asc{% endif %}">Дата продажу</a>
                </th>
                <th>
                    <input name="filter_selling_price" type="number">
                    <a href="?sort=selling_price&dir={% if sort_field == 'selling_price' and direction == 'asc' %}desc{% else %}asc{% endif %}">Ціна продажу</a>
                </th>
                <th>
                    <input name="filter_profit" type="number">
                    <a href="?sort=profit&dir={% if sort_field == 'profit' and direction == 'asc' %}desc{% else %}asc{% endif %}">Прибуток</a>
                </th>
                <th><button type="submit">ОК</button><br><br></th>
            </tr>
            {% for sale in all_sales %}
            <tr>
                <td>{{ sale.id }}</td>
                <td>{{ sale.worker.full_name }}</td>
                <td>{{ sale.car.producer_name }} {{ sale.car.model }}</td>
                <td>{{ sale.sale_date }}</td>
                <td>{{ sale.selling_price }} $</td>
                <td>{{ sale.profit }} $</td>
                <td><a href="{% url 'sale_details' sale.id%}">Детальніше</a></td>
            </tr>
            {% endfor %}
        </table>
      <br>
      <a href="{% url 'create_sale' %}">➕ Додати новий продаж</a>
    </form>
{% endblock %}